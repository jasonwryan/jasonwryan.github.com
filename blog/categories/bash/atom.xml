<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: bash | jasonwryan.com]]></title>
  <link href="http://jasonwryan.github.com/blog/categories/bash/atom.xml" rel="self"/>
  <link href="http://jasonwryan.github.com/"/>
  <updated>2012-03-27T22:24:43+13:00</updated>
  <id>http://jasonwryan.github.com/</id>
  <author>
    <name><![CDATA[Jason Ryan]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Setting Urgent Hints in dwm]]></title>
    <link href="http://jasonwryan.github.com/blog/2011/01/25/setting-urgent-hints-in-dwm/"/>
    <updated>2011-01-25T17:45:00+13:00</updated>
    <id>http://jasonwryan.github.com/blog/2011/01/25/setting-urgent-hints-in-dwm</id>
    <content type="html"><![CDATA[<p><a href="http://www.flickr.com/photos/jasonwryan/5379701719/#/photos/jasonwryan/5379701719/lightbox/" title="Arch Linux: dwm with statuscolors patch"><img src="http://dl.dropbox.com/u/261312/Blog-images/dwm-urgent.png" alt="image" /></a></p>

<p>After nearly 12 months of running a pretty stable
<a href="http://dwm.suckless.org" title="dwm homepage">dwm</a>, with a consistent
patchset (cycle,
<a href="http://dwm.suckless.org/patches/push" title="Push on suckless wiki">push</a>,
and init pertag<sup>1</sup>) I finally added another one:
statuscolours<sup>2</sup>…</p>

<p>I have been experimenting with
<a href="http://jasonwryan.com/post/2461350935/wmfs" title="My post on using WMFS">WMFS</a>,
which is another very nice, minimal tiling window manager and was really
enjoying the urgency hints in the status bar, so I decided to patch that
functionality into dwm.</p>

<p>Most terminal applications will send a bell when your attention is
required; in my case, I was looking for a way to trigger notifications
for new mail in
<a href="http://www.mutt.org/" title="If you are using another mail user agent, you are doing it wrong...">mutt</a>
or highlights in <a href="http://irssi.org/" title="IRC client">irssi</a>. In mutt, it
was just a case of setting a bell for when mail arrived:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">set </span>beep_new             <span class="c"># bell on new mail</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>And in irssi:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">beep_msg_level</span> <span class="o">=</span> <span class="s2">&quot;NOTICE MSGS HILIGHT&quot;</span>;
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>In <a href="http://tmux.sourceforge.net/" title="terminal mulitplexer">tmux</a>, to cover
all your terminal bases, add:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">set</span> -g bell-action any <span class="c"># listen for activity on all windows</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The next step is to pass those beeps to your terminal. The entry for
Urxvt is one I picked up after a quick search turned up
<a href="http://rsontech.net/articles/2008/11/17/1/handling-urgency-hints" title="Post on reson.tech">this post by rson</a>
which had the .Xdefaults line I was looking for:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>URxvt*urgentOnBell: <span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Now, whenever a bell is triggered in irssi or mutt, that is passed to
the terminal as an urgent hint. The final step was patching statuscolors
into dwm.c to change the tag colour when the hint was received.</p>

<p>You can see my
<a href="http://beta.intuxication.org/jasonwryan/archer/file/tip/Build/dwm/5.8.2-2.diff" title="dwm.c patched">patched dwm.c</a>
in my intuxication repo.</p>

<div class="footnotes">
1. These patches are from the extremely helpful Arch Forum thread: 
<a href="https://bbs.archlinux.org/viewtopic.php?id=92895" title="Thread on Arch boards for dwm hackers">DWM Hackers Unite!</a>
<br />
2. I used a <a href="http://lists.suckless.org/dev/1011/6445.html" title="Dan Brown's patch">modified statuscolours patch</a>
from the suckless mailing list. It irons out the padding issues in the one on the wiki.
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mail Checking Script]]></title>
    <link href="http://jasonwryan.github.com/blog/2011/01/08/mail-checking-script/"/>
    <updated>2011-01-08T11:04:00+13:00</updated>
    <id>http://jasonwryan.github.com/blog/2011/01/08/mail-checking-script</id>
    <content type="html"><![CDATA[<p><img src="http://dl.dropbox.com/u/261312/Blog-images/mailcheck.png" alt="image" /></p>

<p>I use <a href="http://www.mutt.org/" title="Mutt homepage">mutt</a> and
<a href="https://github.com/jgoerzen/offlineimap/wiki" title="Offlineimap on github">offlineimap</a>
to manage email on my Arch Linux machines. I like the simplicity and the
power that this approach offers; that’s power in the sense of
extensibility and customization, by the way…</p>

<p>Using <a href="http://dwm.suckless.org/" title="dwm homepage">dwm</a> as my window
manager, I had relied on
<a href="http://jasonwryan.com/2009-11-21-dzen2-and-conky-cli-in-dwm" title="My post on setting this up">conky and dzen2</a>
to pipe system information into my status bar. Unfortunately, conky only
supports one mail spool so if, like me, you use offlineimap to
synchronize multiple mailboxes, conky would only show new mail in your
primary box. I had asked in #conky about multiple mail spools, but it
doesn’t seem to be supported.</p>

<p>When I recently started using
<a href="http://jasonwryan.com/2010-12-26-wmfs-window-manager-from-scratch" title="My post on Window Manager From Scratch">WMFS</a>
I decided to move to a
<a href="http://beta.intuxication.org/jasonwryan/archer/file/tip/Scripts/wmfs-status" title="Script in intuxication repo">bash script for my status information</a>.
So I approached the problem afresh and decided to write a script to poll
the new mail directories and update my status bar when mail arrived.</p>

<p>Offlineimap creates a directory structure like so:</p>

<pre><code>   Mail/ -------
      |         |
      |     Mail_Account_1
      |         |
      |         | --  INBOX 
      |         |       | -- cur
      |         |       | -- new
      |         |       | -- temp
      |         |
      |         | -- INBOX.Drafts
      |         |       | -- cur
</code></pre>

<p>As I was only interested in checking the <span class="file">INBOX/new</span>
directory of each account, I had imagined that it would be necessary to set up some
elaborate array to effectively check each of the requisite sub-directories…</p>

<p>No, it was pretty simple. Just
<a href="http://www.faqs.org/docs/abs/HTML/globbingref.html" title="ABS entry on globing">globbing</a>
and
<a href="http://linuxmanpages.com/man1/find.1.php" title="man page for find">find</a>,
actually.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>mailcheck.sh </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;!/bin/bash&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Set maildirs&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;maildirs<span class="o">=</span><span class="s2">&quot;$HOME/Mail/*/INBOX/new/&quot;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;find <span class="nv">$maildirs</span> -type f | wc -l
</span><span class='line'><span class="nb">exit </span>0
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The glob (<code>*</code>) takes care of the different mail account names, and has
the added bonus of being portable, and find returns any files (<code>-type f</code>)
with <code>wc</code> counting the number of lines (the <code>-l</code> switch).</p>
]]></content>
  </entry>
  
</feed>
