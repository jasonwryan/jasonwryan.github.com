
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Signing Your Own Key - jasonwryan.com</title>
  <meta name="author" content="Jason Ryan">

  
  <meta name="description" content="Some time in the last couple of days, the last of the packages in the
Community repository were signed and, thanks to the tremendous work of
the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jasonwryan.github.com/blog/2012/03/23/key">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="jasonwryan.com" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-907012-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">jasonwryan.com</a></h1>
  
    <h2>Miscellaneous ephemera…</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://www.duckduckgo.com/" method="get">
  <fieldset role="search">
    <!-- <input type="hidden" name="q" value="site:jasonwryan.github.com" /> -->
    <input type="hidden" name="sites" value="jasonwryan.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search duckduckgo&hellip;"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/contact.html">Contact</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Signing Your Own Key</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-23T11:36:00+13:00" pubdate data-updated="true">Mar 23<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><img src="http://dl.dropbox.com/u/261312/Blog-images/key.jpg" alt="image" /></p>

<p>Some time in the last couple of days, the last of the packages in the
Community repository were signed and, thanks to the tremendous work of
the Arch developers and Trusted Users, you can fully implement package
signing in your <span class="file">/etc/pacman.conf</span>.</p>

<p>You can check the state of the signed packages with this <code>expac</code>
one-liner; it will return a list of any <em>unsigned</em> packages:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>expac -S <span class="s1">&#39;%r %n %g&#39;</span> | awk <span class="s1">&#39;$3==&quot;(null)&quot; {print $1 &quot;/&quot; $2}&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now that the packages are all signed, I updated my <span class="file">/etc/pacman.conf</span> to
take advantage of this. My overall <code>SigLevel</code> setting requires signed
packages, and—as of yesterday—I was able to move the last repository
entry over to do the same:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">SigLevel</span> <span class="o">=</span> Required DatabaseOptional TrustedOnly
</span><span class='line'>
</span><span class='line'><span class="o">[</span>core<span class="o">]</span>
</span><span class='line'><span class="nv">SigLevel</span> <span class="o">=</span> PackageRequired
</span><span class='line'><span class="nv">Include</span> <span class="o">=</span> /etc/pacman.d/mirrorlist
</span><span class='line'>
</span><span class='line'><span class="o">[</span>extra<span class="o">]</span>
</span><span class='line'><span class="nv">SigLevel</span> <span class="o">=</span> PackageRequired
</span><span class='line'><span class="nv">Include</span> <span class="o">=</span> /etc/pacman.d/mirrorlist
</span><span class='line'>
</span><span class='line'><span class="o">[</span>community<span class="o">]</span>
</span><span class='line'><span class="nv">SigLevel</span> <span class="o">=</span> PackageRequired
</span><span class='line'><span class="nv">Include</span> <span class="o">=</span> /etc/pacman.d/mirrorlist
</span><span class='line'>
</span><span class='line'><span class="o">[</span>multilib<span class="o">]</span>
</span><span class='line'><span class="nv">SigLevel</span> <span class="o">=</span> PackageRequired
</span><span class='line'><span class="nv">Include</span> <span class="o">=</span> /etc/pacman.d/mirrorlist
</span></code></pre></td></tr></table></div></figure>


<p>The next step was to add my key to pacman’s keychain so that I could
sign the packages that I build using ABS or from the
<a href="https://aur.archlinux.org/" title="Arch User Repository">AUR</a>. Allan has an
<a href="http://allanmcrae.com/2011/08/pacman-package-signing-1-makepkg-and-repo-add/" title="The first in a series of four posts on signing: read them all">excellent post on setting this up</a>.</p>

<p>First, import your key into pacman’s keyring:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>pacman-key -r 0xB1BD4E40
</span></code></pre></td></tr></table></div></figure>


<p>Then follow the prompts as you edit the key to sign, set a trust level
and save your key:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>pacman-key --edit-key 0xB1BD4E40
</span><span class='line'>gpg&gt; lsign
</span><span class='line'>...
</span><span class='line'>gpg&gt; trust
</span><span class='line'>...
</span><span class='line'>gpg&gt; save
</span></code></pre></td></tr></table></div></figure>


<p>Then it is just a matter of changing the <code>BUILDENV</code> option in your
<span class="file">/etc/makepkg.conf</span>, which is set to <code>!sign</code>
by default. Remove the bang and include the details of the key you wish to use:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#-- Packager: name/email of the person or organization building packages</span>
</span><span class='line'><span class="nv">PACKAGER</span><span class="o">=</span><span class="s2">&quot;Jason Ryan &lt;jasonwryan@gmail.com&gt;&quot;</span>
</span><span class='line'><span class="c">#-- Specify a key to use for package signing</span>
</span><span class='line'><span class="nv">GPGKEY</span><span class="o">=</span><span class="s2">&quot;B1BD4E40&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, when you build a package, you will be prompted for your key’s
passphrase:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">==</span>&gt; Signing package...
</span><span class='line'>
</span><span class='line'>You need a passphrase to unlock the secret key <span class="k">for</span>
</span><span class='line'>user: <span class="s2">&quot;Jason W Ryan &lt;jasonwryan@gmail.com&gt;&quot;</span>
</span><span class='line'>2048-bit RSA key, ID B1BD4E40, created 2010-08-21
</span><span class='line'>
</span><span class='line'>Enter passphrase:
</span></code></pre></td></tr></table></div></figure>


<p>Enter the correct passphrase and your package is built and signed:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>-&gt; Created signature file /home/jason/Build/<span class="o">{</span>pkg<span class="o">}</span>.pkg.tar.xz.sig.
</span></code></pre></td></tr></table></div></figure>


<p>Creative Commons image by
<a href="http://www.flickr.com/photos/donovan_beeson/3185668524/" title="Coraline key on Flickr">donovanbeeson</a>
on Flickr.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jason Ryan</span></span>

      








  


<time datetime="2012-03-23T11:36:00+13:00" pubdate data-updated="true">Mar 23<span>rd</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/archlinux/'>archlinux</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/03/17/vampires/" title="Previous Post: A Taxonomy of Help Vampires">&laquo; A Taxonomy of Help Vampires</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/03/30/octopress/" title="Next Post: Moving to Octopress">Moving to Octopress &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/03/30/octopress/">Moving to Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/23/key/">Signing Your Own Key</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/17/vampires/">A Taxonomy of Help Vampires</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/09/aurphan/">Simple aurphan notifier</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/13/chroot/">Chroot in LVM on LUKS on Raid: Arch Linux</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("jasonwryan", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <p>Follow <a href="http://twitter.com/jasonwryan">@jasonwryan</a></p>
  
</section>


<section>
  <h1>My Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll...</ul>
  <p><a href="http://pinboard.in/u:jasonwryan">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "jasonwryan"; //id target for pinboard list
  var pinboard_count = 3; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>


<section class="lastfm">
<h1>Recently Scrobbled</h1>
<style type="text/css">
  #lastfmList li{ text-align: left; }
</style>
<ul id="lastfmList">
  <li class="loading">Updating tracks...</li>
</ul>
<p><a href="http://alpha.libre.fm/user/jasonwryan">My tunes on Libre.fm &raquo;</a></p>

<script type="text/javascript">
  $.domReady(function(){
    getLastfmFeed("jasonwryan", 5, "3a19a6604d742024a1331bebb7a68d33");
  });
</script>

<script lang="Javascript">
function getLastfmFeed(user,count,api_key) {
  count = parseInt(count, 10);
  $.ajax({
      url: "http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=" + user + "&limit=" + count + "&api_key=" + api_key
    , type: 'xml'
    , error: function (err) { $('#lastfmList li.loading').addClass('error').text("Last.fm's busted"); }
    , success: function(data) { showLastfmFeed(data); }
  });
}

function showLastfmFeed(xml){
  var tracklist = document.getElementById('lastfmList'),
      content = '',
      i=0;
  
  $(xml.responseXML).find("recenttracks").children().each(function(){
    var artist = $(this).find('artist').text(),
        name = $(this).find('name').text(),
        date = $(this).find('date').text(),
        url = $(this).find('url').text();
    content += '<li id="lastfmItem_'+i+'"><a href="'+ url + '">' + name +'</a> by '+ artist + '<span class="date"> ' + prettyDate(date) + ' ago</span></li>';
    i+=1;
  });

  tracklist.innerHTML = content;
}
</script>
</section>

<section>
<p class="arch"><a href="https://archlinux.org/" title="Arch Linux"><img src="http://dl.dropbox.com/u/261312/running-on-arch.png" /></a></p>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
All content licensed under <a href="http://creativecommons.org/licenses/by/2.5/" title="Creative Commons by Attribution">Creative Commons</a> 2012 - Jason Ryan    
<span class="credit">Site powered by <a href="http://vim.org">Vim</a>, <a href="http://octopress.org">Octopress</a> and <a href="http://github.com">Github</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jasonwryan';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jasonwryan.github.com/blog/2012/03/23/key/';
        var disqus_url = 'http://jasonwryan.github.com/blog/2012/03/23/key/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
