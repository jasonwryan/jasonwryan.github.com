
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>jasonwryan.com</title>
  <meta name="author" content="Jason Ryan">

  
  <meta name="description" content="I posted a couple of weeks ago about
Building Vim and how,
using ABS
and makepkg it is possible to customize packages in the repositories to suit &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jasonwryan.com/blog/page/10">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="jasonwryan.com" type="application/atom+xml">
  <!-- OpenId login -->
<link rel="openid2.provider" href="https://openid.stackexchange.com/openid/provider">
<link rel="openid2.local_id" href="https://openid.stackexchange.com/user/e970c157-315b-49b2-8b30-1d8a64215d0f">

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-907012-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">jasonwryan.com</a></h1>
  
    <h2>Miscellaneous ephemera…</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://www.duckduckgo.com/" method="get">
  <fieldset role="search">
    <!-- <input type="hidden" name="q" value="site:jasonwryan.com" /> -->
    <input type="hidden" name="sites" value="jasonwryan.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search duckduckgo&hellip;"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/contact.html">Contact</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/18/pkgbuilds/">Hacking PKGBUILDs</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-18T10:10:00+12:00" pubdate data-updated="true">May 18<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/images/post_images/woodcutting.jpg" title="'Cutting wood'" >
I posted a couple of weeks ago about
<a href="http://jasonwryan.com/blog/2013/03/29/vim/" title="Post on Vim">Building Vim</a> and how,
using <a href="https://wiki.archlinux.org/index.php/Abs" title="Arch Build System on the Wiki">ABS</a>
and <code>makepkg</code> it is possible to customize packages in the repositories to suit your
individual requirements, in that case with a specific feature set.</p>

<p>One of Arch&#8217;s real strengths is in the flexibility that <code>makepkg</code> and PKGBUILDs provide
the community; the ability to adapt official packages—or unofficial ones in the
<a href="https://aur.archlinux.org/" title="Arch User Repository">AUR</a>—as you see fit. As PKGBUILDs
are just shell scripts, the entry level to start playing around with them is quite
low<sup>1</sup>.</p>

<p>A fairly standard, and simple, example of the type of customization that I might make
is with <a href="http://tools.suckless.org/dmenu/" title="dmenu page">dmenu</a>, the suckless dynamic
menu, where the
<a href="https://www.archlinux.org/packages/community/x86_64/dmenu/" title="Arch package">standard package</a>
in the Arch repositories is not patched for Xft support. There is a patch for this on the
<a href="http://tools.suckless.org/dmenu/patches/xft" title="Xft patch on suckless.org">suckless wiki</a>, so it
is just a case of making the requisite changes in the PKGBUILD from ABS and building it.</p>

<p>As you can see from the <code>diff</code> below, there is not a lot involved in this exercize; essentially,
adding <code>libxft</code> as a dependency, sourcing the patch from the suckless site (and including the
hash for it), and then in the <code>build</code> function ensuring that the patch is applied and the
Makefile updated with the new library:</p>

<figure class='code'> <div class="highlight"><pre><code class='diff'><span class='line'><span class="gd">--- PKGBUILD   2013-05-18 09:33:07.156328812 +1200</span>
</span><span class='line'><span class="gi">+++ PKGBUILD   2012-11-14 09:25:15.915335588 +1300</span>
</span><span class='line'><span class="gu">@@ -11,16 +6,22 @@</span>
</span><span class='line'> pkgdesc=&quot;A generic menu for X&quot;
</span><span class='line'> url=&quot;http://tools.suckless.org/dmenu/&quot;
</span><span class='line'> arch=(&#39;i686&#39; &#39;x86_64&#39;)
</span><span class='line'><span class="gi">+groups=(&#39;modified&#39;)</span>
</span><span class='line'> license=(&#39;MIT&#39;)
</span><span class='line'><span class="gd">-depends=(&#39;sh&#39; &#39;libxinerama&#39;)</span>
</span><span class='line'><span class="gd">-source=(http://dl.suckless.org/tools/$pkgname-$pkgver.tar.gz)</span>
</span><span class='line'><span class="gd">-md5sums=(&#39;9c46169ed703732ec52ed946c27d84b4&#39;)</span>
</span><span class='line'><span class="gi">+depends=(&#39;sh&#39; &#39;libxinerama&#39; &#39;libxft&#39;)</span>
</span><span class='line'><span class="gi">+source=(http://dl.suckless.org/tools/$pkgname-$pkgver.tar.gz</span>
</span><span class='line'><span class="gi">+http://tools.suckless.org/dmenu/patches/$pkgname-$pkgver-xft.diff)</span>
</span><span class='line'><span class="gi">+md5sums=(&#39;9c46169ed703732ec52ed946c27d84b4&#39;</span>
</span><span class='line'><span class="gi">+         &#39;d448ec9120718b0aedbdb338f4fa69ba&#39;)</span>
</span><span class='line'>
</span><span class='line'> build(){
</span><span class='line'>   cd $srcdir/$pkgname-$pkgver
</span><span class='line'><span class="gi">+  patch -p1 &lt; ../$pkgname-$pkgver-xft.diff</span>
</span><span class='line'><span class="gi">+  sed -i &#39;s:-I/usr/local/include/freetype2:-I/usr/include/freetype2:&#39; config.mk</span>
</span><span class='line'><span class="gi">+</span>
</span><span class='line'>   make \
</span></code></pre></div></figure>


<p>Running <code>makepkg -i</code> will build and install dmenu with Xft support. This is the most
straightforward approach. I also, primarily by way of experimentation and in an effort
to try an understand how this actually works, have slightly more convoluted examples.
<a href="https://www.archlinux.org/packages/extra/x86_64/msmtp/" title="Arch package">msmtp</a>, the
<acronym title="Simple Mail Transfer Protocol">SMTP</acronym> client has a couple
of makedepends in
<a href="https://www.archlinux.org/packages/extra/x86_64/libgnome-keyring/" title="Arch package">libgnome-keyring</a>
and <a href="https://www.archlinux.org/packages/extra/any/texlive-core/" title="Arch package">texlive-core</a>; the former
I have zero use for and the latter is only installed on my desktop, so I have no wish to install it on
my laptop just to be able to send emails…</p>

<p>In this case, I modified the PKGBUILD to completely remove the <code>libgnome-keyring</code> dependency
and to only build the <code>msmtp</code> documentation in <code>.pdf</code> and <code>.html</code> if <code>texlive-core</code> was
already installed on the machine. Unfortunately, I wasn&#8217;t able to test for the presence of
<code>texlive-core</code> with the standard utilities like <code>type</code> or <code>which</code>, so—as it is installed
on all my boxes—I went with <code>expac</code> (<code>pacman -Q</code> would also work):</p>

<figure class='code'> <div class="highlight"><pre><code class='diff'><span class='line'><span class="gd">--- PKGBUILD    2013-05-18 09:32:07.393095131 +1200</span>
</span><span class='line'><span class="gi">+++ PKGBUILD    2013-05-18 09:31:55.449986364 +1200</span>
</span><span class='line'><span class="gu">@@ -1,7 +1,8 @@</span>
</span><span class='line'> arch=(&#39;i686&#39; &#39;x86_64&#39;)
</span><span class='line'><span class="gi">+groups=(&#39;modified&#39;)</span>
</span><span class='line'> license=(&#39;GPL3&#39;)
</span><span class='line'> url=&quot;http://msmtp.sourceforge.net&quot;
</span><span class='line'><span class="gd">-makedepends=(&#39;texlive-core&#39; &#39;gsasl&#39; &#39;libgnome-keyring&#39;)</span>
</span><span class='line'><span class="gi">+makedepends=(&#39;gsasl&#39;)</span>
</span><span class='line'> source=(http://download.sourceforge.net/sourceforge/msmtp/${pkgbase}-${pkgver}.tar.bz2)
</span><span class='line'> sha1sums=(&#39;c0edce1e1951968853f15209c8509699ff9e9ab5&#39;)
</span><span class='line'>
</span><span class='line'><span class="gu">@@ -12,19 +13,24 @@</span>
</span><span class='line'>
</span><span class='line'> build() {
</span><span class='line'>   cd ${pkgbase}-${pkgver}
</span><span class='line'><span class="gd">-  ./configure --prefix=/usr --sysconfdir=/etc --with-ssl=gnutls</span>
</span><span class='line'><span class="gi">+  ./configure --prefix=/usr --sysconfdir=/etc --with-ssl=gnutls --without-gnome-keyring</span>
</span><span class='line'>   make
</span><span class='line'><span class="gd">-  make -C doc html pdf</span>
</span><span class='line'><span class="gi">+  if [[ -n $(expac -Q &#39;%n&#39; texlive-core) ]]; then</span>
</span><span class='line'><span class="gi">+      make -C doc html pdf</span>
</span><span class='line'><span class="gi">+  fi</span>
</span><span class='line'> }
</span><span class='line'>
</span><span class='line'> package_msmtp() {
</span><span class='line'>   pkgdesc=&quot;A mini smtp client&quot;
</span><span class='line'><span class="gd">-  depends=(&#39;gsasl&#39; &#39;libgnome-keyring&#39;)</span>
</span><span class='line'><span class="gi">+  depends=(&#39;gsasl&#39;)</span>
</span><span class='line'>   install=msmtp.install
</span><span class='line'>
</span><span class='line'>   cd ${pkgbase}-${pkgver}
</span><span class='line'>   make DESTDIR=&quot;${pkgdir}&quot; install
</span><span class='line'><span class="gi">+</span>
</span><span class='line'><span class="gi">+  if [[ -n $(expac -Q &#39;%n&#39; texlive-core) ]]; then</span>
</span><span class='line'>   make DESTDIR=&quot;${pkgdir}&quot; -C doc install-html install-pdf
</span><span class='line'><span class="gi">+  fi</span>
</span><span class='line'>
</span><span class='line'> # Installing example configs and scripts to /usr/share/doc/msmtp
</span></code></pre></div></figure>


<p>It isn&#8217;t necessarily an attractive solution, but it works for me…
On the subject of unattractive solutions, as of pacman 4.1, released
last month, the packaging standards for
<a href="https://wiki.archlinux.org/index.php/VCS_PKGBUILD_Guidelines" title="Arch Wiki page">VCS PKGBUILDs</a>
have been changed, principally around how sources and versioning is handled. For
the couple of VCS packages I maintain in the <acronym title="Arch User
Repository">AUR</acronym><sup>2</sup>, I have been
experimenting with how to capture the <code>pkgver</code> in a way that conforms to the
standards and provides people with a meaningful version number.</p>

<p>By default, the version number for these projects from their git repos
is not that helpful:</p>

<figure class='code'> <div class="highlight"><pre><code class='sh'><span class='line'>git describe --always
</span><span class='line'>4861046
</span></code></pre></div></figure>


<p>After looking through the git logs, and playing around with <code>awk</code> to filter
the results, I came up with this:</p>

<figure class='code'> <div class="highlight"><pre><code class='sh'><span class='line'>pkgver<span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="nb">cd</span> <span class="s2">&quot;$_gitname&quot;</span>
</span><span class='line'>  <span class="nb">printf</span> <span class="s1">&#39;%s\n&#39;</span> <span class="s2">&quot;$(awk &#39;/^ / {print $2}&#39; &lt;(git log --grep=version -1))_\</span>
</span><span class='line'><span class="s2">  $(git describe --always)&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></div></figure>


<p>This prints a more, for me anyway, intelligble package version: <code>vimprobable2-git
1.2.1_c5936cc-1</code> that relates back to the last stable release and appends the
current commit. I&#8217;m sure that this could be improved upon; suggestions are
welcome.</p>

<p>The other change to note in all of these PKGBUILDs is the inclusion of the
<code>groups</code> variable. By adding all of the modified packages from the official
repositories to the—imaginatively titled—<code>modified</code> group, I can then add a line
to <code>/etc/pacman.conf</code> that prevents those packages from being overwritten on
upgrade<sup>3</sup>:</p>

<figure class='code'> <div class="highlight"><pre><code class='sh'><span class='line'><span class="nv">IgnoreGroup</span> <span class="o">=</span> modified
</span></code></pre></div></figure>


<p>Issuing <code>pacman -Syu</code>, or running <code>checkupdates</code> from a <code>cron</code> job, will
notify you that the packages have had a version bump and that they need
to be rebuilt. The PKGBUILDs for all of these packages can be found in
<a href="https://bitbucket.org/jasonwryan/centurion/src/ff3b3c9d805e197f35aa28dbeb6a9a6555ee7b63/Build?at=default" title="Files in bitbucket">my bitbucket repo</a>.</p>

<h4>Notes</h4>

<ol>
<li>As my experiments attest…</li>
<li><a href="https://aur.archlinux.org/packages/vimprobable2-git/">Vimprobable2-git</a>,
<a href="https://aur.archlinux.org/packages/surfraw-git/">Surfraw-git</a> and
<a href="https://aur.archlinux.org/packages/ruby-build-git/">ruby-build-git</a>.</li>
<li>All credit to ataraxia <a href="https://bbs.archlinux.org/viewtopic.php?pid=623841#p623841">for this idea</a>.</li>
</ol>


<p>Creative Commons image on Flickr by
<a href="http://www.flickr.com/photos/wellspwilson/6481217091/" title="Wood
Cutting Wood">Wells P. Wilson</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/04/09/helpers/">AUR Helpers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-09T19:07:00+12:00" pubdate data-updated="true">Apr 9<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/images/post_images/crutches.jpg" title="'Crutches on Flickr'" ></p>

<h3>Or, &#8220;Why you should uninstall Yaourt and embrace <em>makepkg</em>…&#8221;</h3>

<p>The <a href="https://bbs.archlinux.org/viewtopic.php?id=160655" title="Announcement on the Arch boards">release of Pacman 4.1</a>
saw the same flurry of posts on the boards, in IRC and the mailing lists about
people being “unable” to upgrade or, worse, claiming that pacman was “broken”
because their upgrade was failing due to unsatisfied dependencies, that pretty
much every pacman upgrade ocassions. How is it possible that so many people can
run an operating system designed for competent users without having even a
basic understanding of how the package manager—one of the single most critical
components of the distribution—works?</p>

<p>Even a cursory perusal of the resulting threads on the boards will quickly
identify the common denominator in these cases:</p>

<blockquote><p>resolving dependencies&#8230;<br/>looking for inter-conflicts&#8230;<br/>error: failed to prepare transaction (could not satisfy dependencies)<br/>:: package-query: requires pacman<4.1</p></blockquote>


<p><a href="https://aur.archlinux.org/packages/package-query/" title="AUR page">package-query</a>
is required by <a href="https://aur.archlinux.org/packages/yaourt/" title="yaourt on AUR">yaourt</a>;
so these upgrades have been stymied by a package that is in the (unsupported)
<acronym title="Arch User Repository">AUR</acronym>? There are a
<a href="https://wiki.archlinux.org/index.php/AUR_Helpers" title="Arch Wiki entry">multitude of AUR helpers</a>,
but <code>yaourt</code> is most commonly used by people who are new to Arch<sup>1</sup>
for two reasons.  First, it is one of the most “featureful” and secondly, and
more to the point of my argument, it can be installed by simply adding an
unsupported repo to <code>pacman.conf</code>; thereby effectively bypassing the need for
the hapless user ever having to use or understand <code>makepkg</code>.</p>

<p>Consequently, over time, people who are habitually using <code>yaourt -Syu --aur</code> to
update both the packages in the supported repositories and those they have
installed from the AUR lose the conceptual distinction between the two.
<code>yaourt</code> obscures this from them and—if they are completely reliant upon it, as
these threads attest they are—they have abnegated responsibility for managing
those unsupported packages and in doing so have found themselves incapable of
understanding the bind they are in.</p>

<p>This sort of obscuring of fundamental operating principles in the pursuit of
“convenience” is anathema to Arch and is precisely the reason I moved away from
using <code>yaourt</code> (and indeed from using Ubuntu when I jumped from that sinking
ship). Any convenience is purely illusory, in reality it just fosters
<a href="http://en.wikipedia.org/wiki/Learned_helplessness" title="Wikipedia entry">learned helplessness</a>.</p>

<p>I understand that the <code>yaourt</code> developer(s) was scratching their own itch, and
this post is not about maligning the project; but there are significant
unintended consequences of giving people a tool that abstracts such a
fundamental element of the distribution away from the user, especially for a
distribution where you are expected to have
<a href="https://wiki.archlinux.org/index.php/The_Arch_Way#User-centric" title="The Arch Way">complete control <em>and responsbility</em> over your system</a>.</p>

<p>To be clear, I don&#8217;t have a complaint with the <em>concept</em> of AUR helpers. I used
<code>yaourt</code> initially before switching to
<a href="http://pbrisbin.com/posts/aurget" title="Patrick Brisbin's AUR helper">aurget</a> and then
alighting on
<a href="https://github.com/falconindy/cower" title="Cower on github">cower</a>, or more particularly,
a partial wrapper for <code>cower</code>:</p>

<figure class='code'><figcaption><span>cowerd </span></figcaption>
 <div class="highlight"><pre><code class='sh'><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'><span class="c"># install AUR packages with cower</span>
</span><span class='line'>
</span><span class='line'><span class="nb">cd</span> <span class="nv">$HOME</span>/Build <span class="o">&amp;&amp;</span> cower -d <span class="s2">&quot;$1&quot;</span>
</span><span class='line'><span class="nv">builddir</span><span class="o">=</span><span class="s2">&quot;$_&quot;</span>
</span><span class='line'><span class="nb">cd</span> <span class="s2">&quot;$builddir&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">${</span><span class="nv">EDITOR</span><span class="k">:-</span><span class="nv">vi</span><span class="k">}</span> PKGBUILD
</span><span class='line'>
</span><span class='line'>makepkg -si <span class="o">&amp;&amp;</span> <span class="nb">cd</span> - &amp;&gt;/dev/null
</span><span class='line'>
</span><span class='line'><span class="nb">read</span> -p <span class="s2">&quot;Remove Build directory? [Y/n]? &quot;</span> yn
</span><span class='line'><span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$yn&quot;</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span> <span class="o">]</span>; <span class="k">then</span>
</span><span class='line'><span class="k">    </span><span class="nb">printf</span> <span class="s2">&quot;\n%s\n&quot;</span> <span class="s2">&quot;Removing build directory...&quot;</span>
</span><span class='line'>    rm -rf <span class="s2">&quot;$builddir&quot;</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="k">    </span><span class="nb">printf</span> <span class="s2">&quot;%s\n&quot;</span> <span class="s2">&quot;Build completed.&quot;</span>
</span><span class='line'><span class="k">fi</span>
</span></code></pre></div></figure>


<p>This provides me the minimum level of automation I require—essentially only
around downloading and installing a package. It doesn&#8217;t automatically handle
dependencies, nor manage updating the packages; that remains, rightly in my
view, <em>my</em> responsibility.</p>

<p>If I were to look to a more fully featured wrapper, I would undoubtedly choose
<a href="https://github.com/e36freak/meat" title="meat on Github">meat</a>, however as on my
desktop machine, I only have ~30 AUR packages installed, I don&#8217;t really need
anything more sophisticated.</p>

<p>So by all means, use an AUR helper. But recognize that it is intended to help
you, not preclude you from being able to accomplish the most simple and
critical task of system maintenance, updating your package manager. Uninstall
<code>yaourt</code> if you are using it and familiarize yourself with <code>makepkg</code>; once you
do understand the relationship between the official repositories and the AUR,
download <code>cower</code> or <code>meat</code>, they are both <em>much</em> better solutions.</p>

<h4>Notes</h4>

<ol>
<li><a href="http://jasonwryan.com/blog/2009/11/21/dzen2-and-conky-cli-in-dwm/" title="Post from 2009">Myself included</a>…</li>
</ol>


<p>Creative Commons image of crutches by
<a href="http://www.flickr.com/photos/wheatfields/118700600/" title="Flickr CC image">net_efekt on Flickr</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/03/29/vim/">Building Vim</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-29T10:17:00+13:00" pubdate data-updated="true">Mar 29<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/images/post_images/vim-logo.png" title="'Vim logo'" >
Apart from a brief, but nevertheless instructive, flirtation with
<a href="http://www.gnu.org/software/emacs/" title="Emacs homepage">Emacs</a><sup>1</sup> I have
been a consistent <a href="http://www.vim.org/" title="Vim home">Vim</a> user over the last three
or four years. Like most Vim users, I have made some progress over that time
in spite of Vim&#8217;s
<a href="http://stackoverflow.com/a/1815372/712613" title="SO answer on Vim">notorious learning curve</a>
and have now reached the point where, belatedly, I think I understand it just enough
to really grasp how little I actually know. It&#8217;s a milestone that speaks more to
necessity than gratification, granted.</p>

<p>In any event, as part of confronting my Vim shortcomings (no
<a href="http://www.vimgolf.com/" title="Vim golf…">golfing</a> for me), I have been able
to land on the features of Vim that I require to be enabled so that I am moderately
productive (in my own, admittedly cloistered, working environment). That, you will
probably not be surprised to read, does not include needing support for Arabic or
Farsi to be built into Vim.</p>

<p>Part of the beauty of Vim is that, unlike it&#8217;s
<a href="http://en.wikipedia.org/wiki/Editor_war#Humor" title="…lacking a decent editor">operating system counterpart Emacs</a>,
you can choose how much functionality you wish to enable at compile-time. You do want
support for Farsi? Then the <code>--with-features=big</code> option is what you are looking for.
If, on the other hand, you just want the barest of bones, editor-wise, you could opt
for the austere minimalism that is <code>--with-features=tiny</code> and find yourself happily
transported back in time to
<a href="https://en.wikipedia.org/wiki/Vi" title="Wikipedia page on Vi">Bill Joy&#8217;s lab in 1976</a>.</p>

<p>You can peruse all of the various features available to Vim using the <code>:help version</code>
command.<sup>2</sup> There is also
<a href="http://www.drchip.org/astronaut/vim/vimfeat.html" title="Vim's versions and features">this table</a>
where the various features are listed against the respective feature flags (tiny, small,
normal, big &amp; huge).</p>

<p>After this
<a href="https://bugs.archlinux.org/task/33019" title="Add +profile to gvim on Flyspray">bug report</a>
late last year, the default Arch PKGBUILD ships with <code>huge</code> as the feature set. Make
what you will of that, but for my purposes it is overkill. With all the magic of
<a href="https://wiki.archlinux.org/index.php/Abs" title="Arch Wiki page on ABS">ABS</a> and
<code>makepkg</code>, however, it is simple enough to build a Vim package that is tailored
to exactly your requirements. For me, that means this set of simplified <code>configure</code>
options:</p>

<figure class='code'> <div class="highlight"><pre><code class='sh'><span class='line'>  ./configure <span class="se">\</span>
</span><span class='line'>    --prefix<span class="o">=</span>/usr <span class="se">\</span>
</span><span class='line'>    --localstatedir<span class="o">=</span>/var/lib/vim <span class="se">\</span>
</span><span class='line'>    --with-features<span class="o">=</span>normal <span class="se">\</span>
</span><span class='line'>    --with-compiledby<span class="o">=</span>Arch:jwr <span class="se">\</span>
</span><span class='line'>    --with-x<span class="o">=</span>yes <span class="se">\</span>
</span><span class='line'>    --enable-acl <span class="se">\</span>
</span><span class='line'>    --disable-gui <span class="se">\</span>
</span><span class='line'>    --disable-signs <span class="se">\</span>
</span><span class='line'>    --disable-netbeans <span class="se">\</span>
</span><span class='line'>    --enable-multibyte
</span></code></pre></div></figure>


<p>With these options, I have the minimum amount of functionality I comfortably
require (including the ability to access the system clipboard, <code>--with-x=yes</code>)
but without the other bloat.</p>

<p>In addition to these changes to the config options, I also strip out all of the
<code>gvim</code>-related stuff from the PKGBUILD as I do not require it. Even though it
is a split package, just building <code>vim</code> still includes options superfluous to
my needs.  As a result, I get Vim with just the features I need, without the
dependencies of <code>ruby</code> and <code>lua</code> and god knows what else.</p>

<p>I&#8217;m not operating under any illusions about the fact that this is
really saving a huge amount of space or, for that matter, drastically reducing the
number of dependencies I have installed. It is partly about understanding how Vim
works at another level while also catering for the obsessive-compulsive drive to
micro-control what is and isn&#8217;t installed on my systems. If you want to scratch either
of the same itches, you can see the full
<a href="https://bitbucket.org/jasonwryan/shiv/src/tip/Build/vim/PKGBUILD" title="Eviscerated Vim PKGBUILD">PKGBUILD in Bitbucket</a>.</p>

<h4>Notes</h4>

<ol>
<li>Still visible in some of my early Arch screenshots
<a href="http://www.flickr.com/photos/jasonwryan/3748882572/in/photostream" title="Emacs in Openbox">on Flickr</a>…</li>
<li>The official documentation for the features is also
<a href="http://vimdoc.sourceforge.net/htmldoc/various.html#+feature-list" title="Vim Feature list">online</a>.</li>
</ol>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/11/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/9/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/10/25/snapclean/">Pruning Tarsnap Archives</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/20/multiarch/">Multi-arch Packages in AUR</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/06/reminder/">Simple Reminders</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/23/asp/">Building from Source</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/02/password/">pass{,word} manager</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll&#8230;</ul>
  <p><a href="http://pinboard.in/u:jasonwryan">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "jasonwryan"; //id target for pinboard list
  var pinboard_count = 3; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>


<section class="lastfm">
<h1>Recently Scrobbled</h1>
<style type="text/css">
  #lastfmList li{ text-align: left; }
</style>
<ul id="lastfmList">
  <li class="loading">Updating tracks&#8230;</li>
</ul>
<p><a href="http://alpha.libre.fm/user/jasonwryan">My tunes on Libre.fm &raquo;</a></p>

<script type="text/javascript">
  $.domReady(function(){
    getLastfmFeed("jasonwryan", 5, "3a19a6604d742024a1331bebb7a68d33");
  });
</script>
<script src="/javascripts/twitter.js" type="text/javascript"> </script>

<script lang="Javascript">
function getLastfmFeed(user,count,api_key) {
  count = parseInt(count, 10);
  $.ajax({
      url: "http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=" + user + "&limit=" + count + "&api_key=" + api_key
    , type: 'xml'
    , error: function (err) { $('#lastfmList li.loading').addClass('error').text("Last.fm's busted"); }
    , success: function(data) { showLastfmFeed(data); }
  });
}

function showLastfmFeed(xml){
  var tracklist = document.getElementById('lastfmList'),
      content = '',
      i=0;
  
  $(xml.responseXML).find("recenttracks").children().each(function(){
    var artist = $(this).find('artist').text(),
        name = $(this).find('name').text(),
        date = $(this).find('date').text(),
        url = $(this).find('url').text();
    content += '<li id="lastfmItem_'+i+'"><a href="'+ url + '">' + name +'</a> by '+ artist + '<span class="date"> ' + prettyDate(date) + ' ago</span></li>';
    i+=1;
  });

  tracklist.innerHTML = content;
}
</script>
</section>

<section>
<p class="arch"><a href="http://unix.stackexchange.com/users/6761/jasonwryan">
<img src="http://unix.stackexchange.com/users/flair/6761.png" border="0" width="208" height="58" alt="profile for jasonwryan at Unix and Linux, Q&amp;A for users of Linux, FreeBSD and other Un*x-like operating systems." title="profile for jasonwryan at Unix and Linux, Q&amp;A for users of Linux, FreeBSD and other Un*x-like operating systems.">
</a></p>
</section>
<section>
<p class="arch"><a href="https://archlinux.org/" title="Arch Linux"><img src="/images/running-on-arch.png" /></a></p>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
All content licensed under <a href="http://creativecommons.org/licenses/by/2.5/" title="Creative Commons by Attribution">Creative Commons</a> 2015 - Jason Ryan    
<span class="credit">This site is powered by <a href="http://vim.org">Vim</a>, <a href="http://octopress.org">Octopress</a> and <a href="http://github.com">Github</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jasonwryan';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
