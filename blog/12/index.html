
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>jasonwryan.com</title>
  <meta name="author" content="Jason Ryan">

  
  <meta name="description" content="One of the canards about Free and Open Source Software that is peddled by the unscrupulous
marketers of proprietary software is that their product &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jasonwryan.com/blog/12/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="jasonwryan.com" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!-- OpenId login -->
<link rel="openid2.provider" href="https://openid.stackexchange.com/openid/provider">
<link rel="openid2.local_id" href="https://openid.stackexchange.com/user/e970c157-315b-49b2-8b30-1d8a64215d0f">

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-907012-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">jasonwryan.com</a></h1>
  
    <h2>Miscellaneous ephemera…</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://www.duckduckgo.com/" method="get">
  <fieldset role="search">
    <input type="hidden" name="sites" value="jasonwryan.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/contact.html">Contact</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/08/documentation/">Read The Fine Manual</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-02-08T19:57:00+13:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>7:57 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/images/post_images/documents.jpg" title="'Documents on Flickr'" >
One of the canards about Free and Open Source Software that is peddled by the unscrupulous
marketers of proprietary software is that their product is superior because, among other
things, the scruffy, sandal-wearing Communists that write and distribute their software
for free do not bother to adequately document that software; thereby placing in jeopardy
the business processes in the enterprise that rely on said software to continue to
profitably grease the wheels of the juggernaut of Capitalism.</p>

<p>At heart, it really is an attempt to paint FOSS as a hobbyist&rsquo;s pursuit, unworthy of
consideration by Fortune 500 <acronym title="Chief Inhibiting Officers">CIOs</acronym>
as it is not in the same league as “professional,” proprietary product. This
<acronym title="Fear, Uncertainty & Doubt">FUD</acronym> is not restricted to
the usual suspects; it has also been raised by other, presumably more
<a href="http://www.osnews.com/story/5180" title="Editorial on OS News">objective commentators</a>:</p>

<blockquote><p>Open Source documentation is terrible. There is no kinder way to put it. Even the commercially distributed software in the Open Source world has substandard documentation. (And believe me, as a technical writer coming from the Windows world, when I tell you that the commercial industrial standards are pretty low). Only a bare handful of Open Source software packages have any documentation at all. And out of the few that do, much of it is either unfinished, inaccurate, or outdated. What counts as explanatory text among geeks would bewilder a nuclear physicist, even a sober one.</p><footer><strong>OSNews Editorial, 2003</strong> <cite><a href='http://www.osnews.com/story/5180'>www.osnews.com/story/5180/&hellip;</a></cite></footer></blockquote>


<p>A more recent survey, published in 2010, identifed the same issue for businesses,
in slightly less histrionic language:</p>

<blockquote><p>The No. 1 reason for not choosing open-source solutions was lack of support followed by poor documentation.</p><footer><strong>Zenoss 2010 Survey</strong> <cite><a href='http://gigaom.com/2010/08/11/enterprise-yeah-were-cool-with-open-source/'>gigaom.com/2010/08/11/&hellip;</a></cite></footer></blockquote>


<p>My experience of FOSS documentation, particularly over the last twelve months, has been just the
opposite.</p>

<p>From the middle of 2012 on, I made a couple of significant changes in my computing
environment; I moved from
<a href="https://wiki.archlinux.org/index.php/SysVinit" title="Archwiki page…">SysVinit</a>
to <a href="http://freedesktop.org/wiki/Software/systemd" title="Project web page">systemd</a>,
garden variety to
<a href="http://jasonwryan.com/blog/2013/01/25/uefi/" title="My post on UEFI booting">UEFI booting</a>
and changed my shell from
<a href="http://www.gnu.org/software/bash/" title="GNU Bash page">Bash</a> to
<a href="http://www.zsh.org/" title="Zsh homepage, one of the ugliest on the Web">Zsh</a>.
In each of these cases I found myself having to turn to the documentation the
community has provided in order to understand the implications of the change,
and to familiarise myself with the new tool or approach.</p>

<p>I posted at the time about <a href="http://jasonwryan.com/blog/2012/08/04/systemd/" title="The Leap to systemd">moving to systemd</a>,
and I don&rsquo;t think—in retrospect—I credited Lennart Poettering enough for the series of posts
he wrote detailing the design decisions and implementation of that system;
those posts (at the time 12, now
<a href="http://0pointer.de/blog/projects" title="Lennart Poettering's blog">grown to 20</a>)
are an impressively thorough, and thoughtful, document of the new init system.</p>

<p>Similarly, when I started reading about <acronym title="Universal Extensible Firmware Interface">UEFI</acronym>
booting, I quickly found myself at <a href="http://www.rodsbooks.com/" title="The author of… Just go there!">Rod Smith&rsquo;s site</a>.
Rod has compiled an exhaustive and authoritative resource on <a href="http://www.rodsbooks.com/gdisk/" title="gdisk page">GPT</a>,
EFI Stub loading and UEFI booting in general. Reading through his clear, approachable
documentation made transitioning to UEFI a much simpler process than, given the
inherent complexity in the ecosystem, I would have thought possible.</p>

<p>Then there is Zsh.</p>

<blockquote><p>Because zsh contains many features, the zsh manual has been split into a number of sections…</p><footer><strong>zsh manual</strong> <cite><a href='http://linux.die.net/man/1/zsh'>linux.die.net/man/1/zsh/&hellip;</a></cite></footer></blockquote>


<p>And goes it on to list those <em>seventeen</em> sections. If you are not a fan of <code>man</code> pages<sup>1</sup>,
there is the
<a href="http://zsh.sourceforge.net/Doc/Release/zsh_toc.html" title="What it says on the tin…">Zsh Documentation</a>,
the <a href="http://zsh.sourceforge.net/Guide/zshguide.html" title="User's Guide">User&rsquo;s Guide</a> and
<a href="http://zshwiki.org/home/" title="Zsh Wiki">wiki</a>. This amounts to a literally staggering
amount of information—it is no wonder that preconfigured zsh systems like
<a href="http://grml.org/zsh/" title="grml homepage">grml</a> are so popular; they provide
relatively simple ingress to the byzantine ways of this powerful shell.</p>

<p>Finally, also last year, I was privileged to chair the judging for the
<a href="http://www.nzosa.org.nz/" title="NZOSA site">2012 New Zealand Open Source Awards</a>.
This exposed me to the amazing contribution
<a href="http://man7.org/mtk/index.html" title="Man pages Michael maintains">Michael Kerrisk</a>
has made to GNU/Linux over the last decade. He is the author, or co-author, of
<em>over 300</em> <code>man</code> pages; and these aren&rsquo;t the glamorous, application pages read
by the masses, but the system pages that document the kernel and <code>glibc</code>
<acronym title="Application Program Interface">APIs</acronym>.</p>

<p>All of this suggests to me that the state of documentation for FOSS is
anything but parlous. At every turn over the last year, when I needed to
be able to refer to documentation for a project, there was a surfeit of it.
And I have only touched on what would normally constitute the primary
sources; there is also all of the other community-driven documentation
around projects, like the
<a href="https://wiki.archlinux.org/" title="The BEST GNU/LINUX wiki on the web">Arch Wiki</a>
or the <a href="http://unix.stackexchange.com/" title="Unix &amp; Linux SE">Stack Exchange sites</a>,
the support available on forums, IRC, blog posts, etc.</p>

<p>Compared to the sterile, mostly out-of-date (and expensive) documentation that
accompanies proprietary software, FOSS is an Alexandrine utopia…</p>

<h4>Notes</h4>

<ol>
<li>And, god knows, <em>I am</em>; <code>man</code> pages are a constant source of knowledge
and delight (and pretty much the only way I can contribute to projects that
I am indebted to).</li>
</ol>


<p>Creative Commons image of documents by
<a href="http://www.flickr.com/photos/mwichary/2322639175/">Marcin Wichary</a> on Flickr.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/25/uefi/">Hi-UEFI Way</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-01-25T19:35:00+13:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>7:35 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/images/post_images/uefi.jpg" title="'Samsung Series 9 Laptop'" >
Just before Christmas my
<a href="https://bitbucket.org/jasonwryan/eeepc/src" title="Bitbucket repo for Archer">EeePC 901</a> started
to behave erratically. Rather than prolong the final throes, I decided to replace it and,
after looking around and having played with a colleague&rsquo;s
<a href="http://www.cnet.com.au/samsung-series-9-13-inch-2012-339341806.htm" title="CNet Review">Samsung Series 9</a>,
I decided that I would swallow my pride, pay the Windows tax and opt for one of these sleek, fast
little notebooks. Given my experience with it over the last six to eight weeks, I am confident that
it was a decision that I am unlikely to regret.</p>

<p>The machine came with
<a href="https://en.wikipedia.org/wiki/Windows_8#Secure_boot" title="Wikipedia entry on Windows 8">Secure Boot</a>
enabled and running Windows 8.<sup>1</sup> After sedulously ignoring the mounting number
of posts on the Arch boards that had <acronym title="Unified Extensible Firmware Interface">UEFI</acronym>
in the title, initially convinced that it had something to do with Apple hardware and therefore
would be unlikely to impact on me at any point in the future, I now found myself in the position of
having to understand all of the disparate elements involved in UEFI booting.</p>

<p>This proved to be a non-trivial task. It is not that there is insufficient information
available; quite the opposite. The Arch Wiki has a typically thorough
<a href="https://wiki.archlinux.org/index.php/UEFI" title="Arch Wiki page">entry on UEFI</a>; the real
challenge is revealed when you scroll to the bottom of that page to the
<a href="https://wiki.archlinux.org/index.php/UEFI#See_also" title="See also section">reference links</a>
where you begin to reach an appreciation that this isn&rsquo;t a drop-in replacement for
Grub in the way <a href="http://jasonwryan.com/blog/2012/07/09/syslinux/" title="My post on moving to Syslinux">Syslinux was</a>,
for example. This is a whole new booting ecosystem.</p>

<p>I wanted a LVM on LUKS setup and, after reading <em>a lot</em> more documentation on
<a href="https://wiki.archlinux.org/index.php/UEFI_Bootloaders" title="Arch Wiki entry">UEFI bootloaders</a>,
<a href="https://wiki.archlinux.org/index.php/GPT" title="Arch Wiki GPT page">GUID Partition Tables</a> and
<a href="http://www.rodsbooks.com/efi-bootloaders/efistub.html" title="Rod Smith's excellent site">EFISTUB</a><sup>2</sup>
than I had bargained on, I felt reasonably well equipped to proceed. And while this was an
admittedly time consuming (and sometimes confusing) process, I believe it was worth it.</p>

<p>Once I had a reasonable grasp of the conceptual model—and I am convinced this is the single
biggest hurdle in this process—I chose the EFISTUB boot approach with
<a href="http://freedesktop.org/wiki/Software/gummiboot" title="gummiboot homepage">gummiboot</a>,
as the boot manager; mostly because it seemed the simplest approach (the name may also
have been a factor).</p>

<p>Armed with all this new knowledge, I embarked on the install process. It didn&rsquo;t take long at
all. Mostly because I couldn&rsquo;t boot in UEFI mode from the USB drive.</p>

<p>Turns out a couple of things were thwarting me; one I had disabled Secure Boot
in the UEFI menu, but had neglected to disable the fast boot option. Secondly,
and more worryingly, I kept encountering kernel panics once I had got the
machine to boot. Seems that booting in UEFI mode triggers a nasty
<a href="https://bugzilla.kernel.org/show_bug.cgi?id=47121" title="On the Kernel bugtracker">bug with the samsung_laptop module</a>.</p>

<p>Once I could boot from the USB drive, I was able to successfully complete the install.
Rather than include a blow-by-blow account of that process here, I
have uploaded
<a href="https://gist.github.com/4618490" title="Gist with installation details">a gist with the details</a>,
for the morbidly curious or preternaturally bored.</p>

<p>The whole process, for me, epitomised what Arch is really about. No matter how comfortable
a point you reach with your understanding of the tools you use, the rolling release model
constantly challenges you to adopt and adapt to new technologies. Sure, I could have just
opted to boot in regular BIOS mode, but what would be the point of that? I wouldn&rsquo;t have
<em>learned</em> anything.</p>

<p>The other thing that quickly became apparent is that, contrary to some commentary
on the boards about the
<a href="https://www.archlinux.org/news/install-media-20120715-released/" title="News item on new install method">removal of the AIF</a>,
the new install scripts are quite superb; simple, direct and quite unambiguous, the whole
install procedure now feels a lot more Arch-like. The developers have done a great
job with these tools.</p>

<h4>Notes</h4>

<ol>
<li><p>Surely the worst operating system, at least in terms of the user interface, I have
had the misfortune to encounter (and I include Vista and Ubuntu&rsquo;s Unity in that
cavalcade of fail)…</p></li>
<li><p>I&rsquo;ll post more on the voluminous documentation around this, and other aspects of
GNU/Linux, in the coming weeks.</p></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/10/truecrypt/">Replacing TrueCrypt</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-01-10T16:02:00+13:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>4:02 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/images/post_images/lock.jpg" title="'Flickr image of lock'" >
I have used <a href="http://truecrypt.org/" title="TrueCrypt homepage">TrueCrypt</a> since just before
I migrated to Linux, so somwehere around six or seven years, dating back to version 3 or 4.
It is an incredibly handy utility, allowing you to create and manage encrypted volumes on
the fly and—for the especially paranoid—to hide the existence of those volumes from
inquisitive others.</p>

<p>In the intervening years, with all aspects of my personal life
increasingly mediated digitally, in order to properly safeguard my privacy,
and that of my family, I have taken to using LUKS to
<a href="http://jasonwryan.com/blog/2012/02/11/lvm/" title="Post on LVM on LUKS">fully encrypt all of my machines</a>.
And I have used TrueCrypt, both personally and for work, to encrypt some of my USB drives and as
a container in <a href="http://dropbox.com/" title="Dropbox homepage">Dropbox</a>
, for as long as
<a href="http://jasonwryan.com/blog/2010/01/11/using-dropbox-to-share-dotfiles/" title="Post on sharing dotfiles with Dropbox">I have used that service</a>.</p>

<p>Early last year, however, I became aware of concerns that TrueCrypt was not truly open source; that almost
all of the larger distros, including Arch, and the Open Source Initiative did not regard TrueCrypt as
free (as in Freedom) software:</p>

<blockquote><p>The TrueCrypt License has not been officially approved by the Open Source Initiative and is not considered "free" by several major Linux distributions (Arch Linux, Debian, Ubuntu, Fedora, openSUSE, Gentoo), mainly because of distribution and copyright-liability reasons.</p><footer><strong>Wikipedia entry on TrueCrypt</strong> <cite><a href='https://en.wikipedia.org/wiki/Truecrypt'>en.wikipedia.org/wiki/Truecrypt/&hellip;</a></cite></footer></blockquote>


<p>When I initially accessed the page, in February 2012, there was also a paragraph—now removed—that
highlighted further, more alarmist, concerns about the shadowy identity of the people behind
TrueCrypt:</p>

<blockquote><p>The anonymity of the developers and the abnormalities mentioned above have led users to raise suspicions about the provenance of the product and speculate about the possible existence of vulnerabilities or backdoors that might exist in the source code or executables. http://www.privacylover.com/encryption/analysis-is-there-a-backdoor-in-truecrypt-is-truecrypt-a-cia-honeypot/ However its open source and it can be check for funerabilities that way. [sic]</p><footer><strong>Wikipedia entry retrieved in February 2012</strong> <cite><a href='https://en.wikipedia.org/w/index.php?title=TrueCrypt&diff=478623780&oldid=478608477'>en.wikipedia.org/w/&hellip;</a></cite></footer></blockquote>


<p>While I don&rsquo;t subscribe to the theory that the CIA have planted a backdoor in the software (if they
had, <a href="https://en.wikipedia.org/wiki/Truecrypt#Operation_Satyagraha" title="FBI operation foiled by TC">it clearly doesn&rsquo;t work</a>),
I was relieved to see at the end of last year that someone had written a simple utility that allows
you to manage TrueCrypt containers from the command line; <a href="https://github.com/bwalex/tc-play" title="tcplay on Guthub">tcplay</a>
is decribed as:</p>

<blockquote><p>a free (BSD-licensed), pretty much fully featured (including multiple keyfiles, cipher cascades, etc) and stable TrueCrypt implementation.</p></blockquote>


<p>With a <a href="https://github.com/bwalex/tc-play/blob/master/LICENSE" title="tcplay license">simple, two paragraph license</a>
and a brief but comprehensive <code>man</code> page, I was sold. I uninstalled TrueCrypt late last year and haven&rsquo;t missed it since. Quite
the contrary. The only “issue” that I have had with tcplay is remembering the commands to map and mount a drive.
Initially, I jotted down some notes, but opening them up several times a week to refer to them quickly seemed
pointless so I eventually wised up and wrote a wrapper script to do the job for me…</p>

<p>The script is quite simple, it finds the first available loop device, maps the encrypted volume to it and
mounts it read-writeable for your user.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="c"># manage truecrypt containers using tcplay</span>
</span><span class='line'>
</span><span class='line'><span class="nv">user</span><span class="o">=</span>jason
</span><span class='line'><span class="nv">cryptdev</span><span class="o">=</span>Safebox
</span><span class='line'><span class="nv">cryptpath</span><span class="o">=</span>/home/jason/Dropbox/<span class="s2">&quot;$cryptdev&quot;</span>
</span><span class='line'><span class="nv">loopdev</span><span class="o">=</span><span class="k">$(</span>losetup -f<span class="k">)</span>
</span><span class='line'><span class="nv">mountpt</span><span class="o">=</span>/media/<span class="s2">&quot;$cryptdev&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># must be run as root</span>
</span><span class='line'><span class="k">if</span> <span class="o">((</span> <span class="nv">$EUID</span> !<span class="o">=</span> 0 <span class="o">))</span>; <span class="k">then</span>
</span><span class='line'><span class="k">  </span><span class="nb">printf</span> <span class="s2">&quot;%s\n&quot;</span> <span class="s2">&quot;You must be root to run this.&quot;</span>
</span><span class='line'>  <span class="nb">exit </span>1
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'><span class="c"># unecrypt and mount container</span>
</span><span class='line'><span class="k">if</span> <span class="o">[[</span> <span class="nv">$1</span> <span class="o">==</span> open <span class="o">]]</span>; <span class="k">then</span>
</span><span class='line'><span class="k">  </span>losetup <span class="s2">&quot;$loopdev&quot;</span> <span class="s2">&quot;$cryptpath&quot;</span>
</span><span class='line'>  tcplay --map<span class="o">=</span><span class="s2">&quot;$cryptdev&quot;</span> --device<span class="o">=</span><span class="s2">&quot;$loopdev&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># read passphrase</span>
</span><span class='line'>  <span class="nb">read</span> -r -s passphrase <span class="s">&lt;&lt;EOF</span>
</span><span class='line'><span class="s">  &quot;$passphrase&quot;</span>
</span><span class='line'><span class="s">EOF</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># mount container</span>
</span><span class='line'>  <span class="o">[[</span> -d <span class="nv">$mountpt</span> <span class="o">]]</span> <span class="o">||</span> mkdir <span class="s2">&quot;$mountpt&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># mount options</span>
</span><span class='line'>  <span class="nv">userid</span><span class="o">=</span><span class="k">$(</span>awk -F<span class="s2">&quot;[=(]&quot;</span> <span class="s1">&#39;{print $2,$4}&#39;</span> &lt;<span class="o">(</span>id <span class="s2">&quot;$user&quot;</span><span class="k">)</span><span class="o">)</span>
</span><span class='line'>  mount -o nosuid,uid<span class="o">=</span><span class="s2">&quot;${userid% *}&quot;</span>,gid<span class="o">=</span><span class="s2">&quot;${userid#* }&quot;</span> /dev/mapper/<span class="s2">&quot;$cryptdev&quot;</span> <span class="s2">&quot;$mountpt&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># close and clean up…</span>
</span><span class='line'><span class="k">elif</span> <span class="o">[[</span> <span class="nv">$1</span> <span class="o">==</span> close <span class="o">]]</span>; <span class="k">then</span>
</span><span class='line'><span class="k">  </span><span class="nv">device</span><span class="o">=</span><span class="k">$(</span>awk -v <span class="nv">dev</span><span class="o">=</span><span class="nv">$cryptdev</span> -F<span class="s2">&quot;:&quot;</span> <span class="s1">&#39;/dev/ {print $1}&#39;</span> &lt;<span class="o">(</span>losetup -a<span class="k">)</span><span class="o">)</span>
</span><span class='line'>  umount <span class="s2">&quot;$mountpt&quot;</span>
</span><span class='line'>  dmsetup remove <span class="s2">&quot;$cryptdev&quot;</span> <span class="o">||</span> <span class="nb">printf</span> <span class="s2">&quot;%s\n&quot;</span> <span class="s2">&quot;demapping failed&quot;</span>
</span><span class='line'>  losetup -d <span class="s2">&quot;$device&quot;</span> <span class="o">||</span> <span class="nb">printf</span> <span class="s2">&quot;%s\n&quot;</span> <span class="s2">&quot;deleting $loopdev failed&quot;</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="k">  </span><span class="nb">printf</span> <span class="s2">&quot;%s\n&quot;</span> <span class="s2">&quot;Options are open or close.&quot;</span>
</span><span class='line'><span class="k">fi</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once you are done, the script will unmount your volume and clean up. Undoubtedly, the
script could be improved; patches are welcome.</p>

<p>There is a
<a href="https://aur.archlinux.org/packages/tcplay-git/" title="Arch User Repository">PKGBUILD in the AUR</a>.
Uninstall TrueCrypt and give tcplay a go, it is a simple, powerful application; and it <em>is</em>
free software…</p>

<h3>Update</h3>

<p>As cr notes in the comments, the <code>uid</code> and <code>gid</code> values are because when I created this container I
needed to ocassionally mount it from windows, so it is a FAT32 filesystem. For ext3 or ext4, you would use
<code>bindfs -u $user -g $group "$mountpt" "$backuppath"</code>.</p>

<h4>Notes</h4>

<p>Creative Commons image on Flickr by <a href="http://www.flickr.com/photos/xserve/368758286/" title="Licensed CC by xserv">xserv</a>.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/13">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/11">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/01/19/overlayfs/">Playing with overlayfs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/25/snapclean/">Pruning Tarsnap Archives</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/20/multiarch/">Multi-arch Packages in AUR</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/06/reminder/">Simple Reminders</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/23/asp/">Building from Source</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll...</ul>
  <p><a href="http://pinboard.in/u:jasonwryan">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "jasonwryan"; //id target for pinboard list
  var pinboard_count = 3; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>


<section class="librefm">
<h1>Listening to</h1>
<style type="text/css">
  #librefmList li{ text-align: left; }
</style>
<ul id="librefmList">
  <li class="loading">Updating tracks...</li>
</ul>
<p><a href="http://alpha.libre.fm/user/jasonwryan">My tunes on Libre.fm &raquo;</a></p>

<script lang="Javascript">
    /*
     * JavaScript Pretty Date
     * Copyright (c) 2011 John Resig (ejohn.org)
     * Licensed under the MIT and GPL licenses.
     */

    // Takes an ISO time and returns a string representing how
    // long ago the date represents.
    function prettyDate(time){
        diff = ((new Date()).getTime()/1000 - time),
        day_diff = Math.floor(diff / 86400);

      if ( isNaN(day_diff) || day_diff < 0 || day_diff >= 31 )
        return;

      return day_diff == 0 && (
          diff < 60 && "just now" ||
          diff < 120 && "1 minute" ||
          diff < 3600 && Math.floor( diff / 60 ) + " minutes" ||
          diff < 7200 && "1 hour" ||
          diff < 86400 && Math.floor( diff / 3600 ) + " hours") ||
        day_diff == 1 && "Yesterday" ||
        day_diff < 7 && day_diff + " days" ||
        day_diff < 31 && Math.ceil( day_diff / 7 ) + " weeks";
    }
</script>
<script lang="Javascript">
    function showLibrefmFeed(json){
        if(json.recenttracks == 'undefined'){
            return
        }

        var tracklist = document.getElementById('librefmList'),
            content = '';

        $.each(json.recenttracks.track, function(i, track){
            var interval = prettyDate(track.date['uts']);
            content += '<li id="librefmItem_'+i+'"><a href="'+ track.url + '">' + track.name +'</a> by '+ track.artist['#text'] + '<span class="date"> ' + interval  + ( interval == 'just now' ? '' :' ago') + '</span></li>';
        });

        tracklist.innerHTML = content;
    }
</script>
<script lang="Javascript" src="https://libre.fm/2.0/?method=user.getrecenttracks&user=jasonwryan&page=1&limit=5&format=json&callback=showLibrefmFeed""></script>

</section>

<section>
<p class="arch"><a href="http://unix.stackexchange.com/users/6761/jasonwryan">
<img src="http://unix.stackexchange.com/users/flair/6761.png" border="0" width="208" height="58" alt="profile for jasonwryan at Unix and Linux, Q&amp;A for users of Linux, FreeBSD and other Un*x-like operating systems." title="profile for jasonwryan at Unix and Linux, Q&amp;A for users of Linux, FreeBSD and other Un*x-like operating systems.">
</a></p>
</section>
<section>
<p class="arch"><a href="https://archlinux.org/" title="Arch Linux"><img src="/images/running-on-arch.png" /></a></p>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
All content licensed under <a href="http://creativecommons.org/licenses/by/2.5/" title="Creative Commons by Attribution">Creative Commons</a> 2016 - Jason Ryan    
<span class="credit">This site is powered by <a href="http://vim.org">Vim</a>, <a href="http://octopress.org">Octopress</a> and <a href="http://github.com">Github</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jasonwryan';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
